<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T17U3">eulerAngles</span>,<span class="var type1" id="S3T16U4">Rot_matrix</span>,<span class="var type1" id="S4T10U5">x_aposteriori</span>,<span class="var type1" id="S5T9U6">P_aposteriori</span>] = attitudeKalmanfilter_wo(<span class="var type1" id="S6T21U9">updateVect</span>,<span class="var type1" id="S7T7U10">dt</span>,<span class="var type1" id="S8T24U11">z</span>,<span class="var type1" id="S9T10U12">x_aposteriori_k</span>,<span class="var type1" id="S10T9U13">P_aposteriori_k</span>,<span class="var type1" id="S11T1U14">q</span>,<span class="var type1" id="S12T22U15">r</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% Extended Attitude Kalmanfilter</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% state vector x has the following entries [ax,ay,az||mx,my,mz||wox,woy,woz||wx,wy,wz]'</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% measurement vector z has the following entries [ax,ay,az||mx,my,mz||wmx,wmy,wmz]'</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% knownConst has the following entries [PrvaA,PrvarM,PrvarWO,PrvarW||MsvarA,MsvarM,MsvarW]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% [x_aposteriori,P_aposteriori] = AttKalman(dt,z_k,x_aposteriori_k,P_aposteriori_k,knownConst)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">% Example<span class="keyword">...</span><span class="comment">.</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% $Author: Tobias Naegeli $    $Date: 2012 $    $Revision: 1 $</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%coder.varsize('udpIndVect', [9,1], [1,0])</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%udpIndVect=find(updVect);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%process and measurement noise covariance matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo" id="T9:U12"><span class="var type1" id="S13T9U18">Q</span> = <span class="mxinfo" id="T9:U14">diag(<span class="mxinfo" id="T1:U15"><span class="mxinfo" id="T1:U16"><span class="var type1" id="S11T1U23">q</span>.^2</span>*<span class="var type1" id="S7T7U25">dt</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%observation matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="mxinfo" id="T7:U19"><span class="var type1" id="S15T7U28">wx</span>=  <span class="mxinfo" id="T7:U21"><span class="var type1" id="S9T10U30">x_aposteriori_k</span>(<span class="mxinfo" id="T2:U23">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo" id="T7:U24"><span class="var type1" id="S16T7U34">wy</span>=  <span class="mxinfo" id="T7:U26"><span class="var type1" id="S9T10U36">x_aposteriori_k</span>(<span class="mxinfo" id="T2:U28">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo" id="T7:U29"><span class="var type1" id="S17T7U40">wz</span>=  <span class="mxinfo" id="T7:U31"><span class="var type1" id="S9T10U42">x_aposteriori_k</span>(<span class="mxinfo" id="T2:U33">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="mxinfo" id="T7:U34"><span class="var type1" id="S18T7U46">wox</span>=  <span class="mxinfo" id="T7:U36"><span class="var type1" id="S9T10U48">x_aposteriori_k</span>(<span class="mxinfo" id="T2:U38">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="mxinfo" id="T7:U39"><span class="var type1" id="S19T7U52">woy</span>=  <span class="mxinfo" id="T7:U41"><span class="var type1" id="S9T10U54">x_aposteriori_k</span>(<span class="mxinfo" id="T2:U43">5</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo" id="T7:U44"><span class="var type1" id="S20T7U58">woz</span>=  <span class="mxinfo" id="T7:U46"><span class="var type1" id="S9T10U60">x_aposteriori_k</span>(<span class="mxinfo" id="T2:U48">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo" id="T7:U49"><span class="var type1" id="S21T7U64">zex</span>=  <span class="mxinfo" id="T7:U51"><span class="var type1" id="S9T10U66">x_aposteriori_k</span>(<span class="mxinfo" id="T2:U53">7</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo" id="T7:U54"><span class="var type1" id="S22T7U70">zey</span>=  <span class="mxinfo" id="T7:U56"><span class="var type1" id="S9T10U72">x_aposteriori_k</span>(<span class="mxinfo" id="T2:U58">8</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"><span class="mxinfo" id="T7:U59"><span class="var type1" id="S23T7U76">zez</span>=  <span class="mxinfo" id="T7:U61"><span class="var type1" id="S9T10U78">x_aposteriori_k</span>(<span class="mxinfo" id="T2:U63">9</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"><span class="mxinfo" id="T7:U64"><span class="var type1" id="S24T7U82">mux</span>=  <span class="mxinfo" id="T7:U66"><span class="var type1" id="S9T10U84">x_aposteriori_k</span>(<span class="mxinfo" id="T2:U68">10</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo" id="T7:U69"><span class="var type1" id="S25T7U88">muy</span>=  <span class="mxinfo" id="T7:U71"><span class="var type1" id="S9T10U90">x_aposteriori_k</span>(<span class="mxinfo" id="T2:U73">11</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo" id="T7:U74"><span class="var type1" id="S26T7U94">muz</span>=  <span class="mxinfo" id="T7:U76"><span class="var type1" id="S9T10U96">x_aposteriori_k</span>(<span class="mxinfo" id="T2:U78">12</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo" id="T17:U79"><span class="var type1" id="S27T17U100">wk</span> =<span class="mxinfo" id="T17:U81">[<span class="var type1" id="S15T7U103">wx</span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo" id="T17:U79"><span class="mxinfo" id="T17:U81">     <span class="var type1" id="S16T7U105">wy</span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo" id="T17:U79"><span class="mxinfo" id="T17:U81">     <span class="var type1" id="S17T7U107">wz</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo" id="T17:U85"><span class="var type1" id="S28T17U110">wok</span> =<span class="mxinfo" id="T17:U87">[<span class="var type1" id="S18T7U113">wox</span>;<span class="var type1" id="S19T7U115">woy</span>;<span class="var type1" id="S20T7U117">woz</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="mxinfo" id="T16:U91"><span class="var type1" id="S29T16U120">O</span>=<span class="mxinfo" id="T16:U93"><span class="mxinfo" id="T16:U94">[<span class="mxinfo" id="T33:U95"><span class="mxinfo" id="T2:U96">0</span>,<span class="mxinfo" id="T7:U97">-<span class="var type1" id="S17T7U126">wz</span></span>,<span class="var type1" id="S16T7U127">wy</span></span>;<span class="mxinfo" id="T33:U100"><span class="var type1" id="S17T7U129">wz</span>,<span class="mxinfo" id="T2:U102">0</span>,<span class="mxinfo" id="T7:U103">-<span class="var type1" id="S15T7U132">wx</span></span></span>;<span class="mxinfo" id="T33:U105"><span class="mxinfo" id="T7:U106">-<span class="var type1" id="S16T7U135">wy</span></span>,<span class="var type1" id="S15T7U136">wx</span>,<span class="mxinfo" id="T2:U109">0</span></span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="mxinfo" id="T17:U110"><span class="var type1" id="S30T17U140">zek</span> =<span class="mxinfo" id="T17:U112">(<span class="mxinfo" id="T16:U113"><span class="mxinfo" id="T15:U114">eye(3)</span>+<span class="mxinfo" id="T16:U115"><span class="var type1" id="S29T16U148">O</span>*<span class="var type1" id="S7T7U149">dt</span></span></span>)*<span class="mxinfo" id="T17:U118">[<span class="var type1" id="S21T7U152">zex</span>;<span class="var type1" id="S22T7U154">zey</span>;<span class="var type1" id="S23T7U156">zez</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="mxinfo" id="T17:U122"><span class="var type1" id="S32T17U159">muk</span> =<span class="mxinfo" id="T17:U124">(<span class="mxinfo" id="T16:U125"><span class="mxinfo" id="T15:U126">eye(3)</span>+<span class="mxinfo" id="T16:U127"><span class="var type1" id="S29T16U167">O</span>*<span class="var type1" id="S7T7U168">dt</span></span></span>)*<span class="mxinfo" id="T17:U130">[<span class="var type1" id="S24T7U171">mux</span>;<span class="var type1" id="S25T7U173">muy</span>;<span class="var type1" id="S26T7U175">muz</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="mxinfo" id="T16:U134"><span class="var type1" id="S33T16U178">EZ</span>=<span class="mxinfo" id="T16:U136"><span class="mxinfo" id="T16:U137">[<span class="mxinfo" id="T33:U138"><span class="mxinfo" id="T2:U139">0</span>,<span class="var type1" id="S23T7U183">zez</span>,<span class="mxinfo" id="T7:U141">-<span class="var type1" id="S22T7U185">zey</span></span></span>;</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="mxinfo" id="T16:U134"><span class="mxinfo" id="T16:U136"><span class="mxinfo" id="T16:U137">    <span class="mxinfo" id="T33:U143"><span class="mxinfo" id="T7:U144">-<span class="var type1" id="S23T7U188">zez</span></span>,<span class="mxinfo" id="T2:U146">0</span>,<span class="var type1" id="S21T7U190">zex</span></span>;</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo" id="T16:U134"><span class="mxinfo" id="T16:U136"><span class="mxinfo" id="T16:U137">    <span class="mxinfo" id="T33:U148"><span class="var type1" id="S22T7U192">zey</span>,<span class="mxinfo" id="T7:U150">-<span class="var type1" id="S21T7U194">zex</span></span>,<span class="mxinfo" id="T2:U152">0</span></span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="mxinfo" id="T16:U153"><span class="var type1" id="S34T16U198">MA</span>=<span class="mxinfo" id="T16:U155"><span class="mxinfo" id="T16:U156">[<span class="mxinfo" id="T33:U157"><span class="mxinfo" id="T2:U158">0</span>,<span class="var type1" id="S26T7U203">muz</span>,<span class="mxinfo" id="T7:U160">-<span class="var type1" id="S25T7U205">muy</span></span></span>;</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="mxinfo" id="T16:U153"><span class="mxinfo" id="T16:U155"><span class="mxinfo" id="T16:U156">    <span class="mxinfo" id="T33:U162"><span class="mxinfo" id="T7:U163">-<span class="var type1" id="S26T7U208">muz</span></span>,<span class="mxinfo" id="T2:U165">0</span>,<span class="var type1" id="S24T7U210">mux</span></span>;</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="mxinfo" id="T16:U153"><span class="mxinfo" id="T16:U155"><span class="mxinfo" id="T16:U156">    <span class="mxinfo" id="T33:U167"><span class="var type1" id="S22T7U212">zey</span>,<span class="mxinfo" id="T7:U169">-<span class="var type1" id="S24T7U214">mux</span></span>,<span class="mxinfo" id="T2:U171">0</span></span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="mxinfo" id="T15:U172"><span class="var type1" id="S35T15U218">E</span>=<span class="mxinfo" id="T15:U174">eye(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="mxinfo" id="T15:U175"><span class="var type1" id="S36T15U224">Es</span>=<span class="mxinfo" id="T15:U177">[1,0,0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="mxinfo" id="T15:U175"><span class="mxinfo" id="T15:U177">    0,1,0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="mxinfo" id="T15:U175"><span class="mxinfo" id="T15:U177">    0,0,0]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="mxinfo" id="T15:U178"><span class="var type1" id="S37T15U240">Z</span>=<span class="mxinfo" id="T15:U180">zeros(3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="mxinfo" id="T10:U181"><span class="var type1" id="S39T10U246">x_apriori</span>=<span class="mxinfo" id="T10:U183">[<span class="var type1" id="S27T17U249">wk</span>;<span class="var type1" id="S28T17U251">wok</span>;<span class="var type1" id="S30T17U253">zek</span>;<span class="var type1" id="S32T17U255">muk</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"><span class="mxinfo" id="T9:U188"><span class="var type1" id="S40T9U258">A_lin</span>=<span class="mxinfo" id="T9:U190">[ <span class="mxinfo" id="T34:U191"><span class="var type1" id="S37T15U261">Z</span>,  <span class="var type1" id="S37T15U262">Z</span>,  <span class="var type1" id="S37T15U263">Z</span>,  <span class="var type1" id="S37T15U264">Z</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"><span class="mxinfo" id="T9:U188"><span class="mxinfo" id="T9:U190">        <span class="mxinfo" id="T34:U196"><span class="var type1" id="S37T15U266">Z</span>,  <span class="var type1" id="S37T15U267">Z</span>,  <span class="var type1" id="S37T15U268">Z</span>,  <span class="var type1" id="S37T15U269">Z</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="mxinfo" id="T9:U188"><span class="mxinfo" id="T9:U190">        <span class="mxinfo" id="T35:U201"><span class="var type1" id="S33T16U271">EZ</span>, <span class="var type1" id="S37T15U272">Z</span>,  <span class="var type1" id="S29T16U273">O</span>,  <span class="var type1" id="S37T15U274">Z</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="mxinfo" id="T9:U188"><span class="mxinfo" id="T9:U190">        <span class="mxinfo" id="T35:U206"><span class="var type1" id="S34T16U276">MA</span>, <span class="var type1" id="S37T15U277">Z</span>,  <span class="var type1" id="S37T15U278">Z</span>,  <span class="var type1" id="S29T16U279">O</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"><span class="mxinfo" id="T9:U211"><span class="var type1" id="S40T9U282">A_lin</span>=<span class="mxinfo" id="T9:U213"><span class="mxinfo" id="T20:U214">eye(12)</span>+<span class="mxinfo" id="T9:U215"><span class="var type1" id="S40T9U288">A_lin</span>*<span class="var type1" id="S7T7U289">dt</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"><span class="mxinfo" id="T9:U218"><span class="var type1" id="S41T9U292">P_apriori</span>=<span class="mxinfo" id="T9:U220"><span class="mxinfo" id="T9:U221"><span class="mxinfo" id="T9:U222"><span class="var type1" id="S40T9U296">A_lin</span>*<span class="var type1" id="S10T9U297">P_aposteriori_k</span></span>*<span class="mxinfo" id="T9:U225"><span class="var type1" id="S40T9U299">A_lin</span>'</span></span>+<span class="var type1" id="S13T9U300">Q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"><span class="comment">%%update</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T5:U228"><span class="mxinfo" id="T48:U229"><span class="var type1" id="S6T21U307">updateVect</span>(<span class="mxinfo" id="T2:U231">1</span>)</span>==<span class="mxinfo" id="T2:U232">1</span></span>&amp;&amp;<span class="mxinfo" id="T5:U233"><span class="mxinfo" id="T48:U234"><span class="var type1" id="S6T21U312">updateVect</span>(<span class="mxinfo" id="T2:U236">2</span>)</span>==<span class="mxinfo" id="T2:U237">1</span></span>&amp;&amp;<span class="mxinfo" id="T5:U238"><span class="mxinfo" id="T48:U239"><span class="var type1" id="S6T21U317">updateVect</span>(<span class="mxinfo" id="T2:U241">3</span>)</span>==<span class="mxinfo" id="T2:U242">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">    <span class="mxinfo" id="T23:U243"><span class="var type1" id="S42T23U322">R</span>=<span class="mxinfo" id="T23:U245">diag(<span class="var type1" id="S12T22U325">r</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">    <span class="comment">%observation matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">    <span class="mxinfo" id="T25:U247"><span class="var type1" id="S43T25U328">H_k</span>=<span class="mxinfo" id="T25:U249">[  <span class="var type1" id="S35T15U331">E</span>,     <span class="var type1" id="S36T15U332">Es</span>,      <span class="var type1" id="S37T15U333">Z</span>,    <span class="var type1" id="S37T15U334">Z</span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"><span class="mxinfo" id="T25:U247"><span class="mxinfo" id="T25:U249">        <span class="var type1" id="S37T15U336">Z</span>,     <span class="var type1" id="S37T15U337">Z</span>,      <span class="var type1" id="S35T15U338">E</span>,    <span class="var type1" id="S37T15U339">Z</span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="mxinfo" id="T25:U247"><span class="mxinfo" id="T25:U249">        <span class="var type1" id="S37T15U341">Z</span>,     <span class="var type1" id="S37T15U342">Z</span>,      <span class="var type1" id="S37T15U343">Z</span>,    <span class="var type1" id="S35T15U344">E</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">    <span class="mxinfo" id="T24:U262"><span class="var type1" id="S44T24U347">y_k</span>=<span class="mxinfo" id="T24:U264"><span class="mxinfo" id="T24:U265"><span class="var type1" id="S8T24U350">z</span>(<span class="mxinfo" id="T49:U267"><span class="mxinfo" id="T2:U268">1</span>:<span class="mxinfo" id="T2:U269">9</span></span>)</span>-<span class="mxinfo" id="T24:U270"><span class="mxinfo" id="T25:U271"><span class="var type1" id="S43T25U355">H_k</span></span>*<span class="var type1" id="S39T10U356">x_apriori</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">    <span class="mxinfo" id="T23:U274"><span class="var type1" id="S45T23U359">S_k</span>=<span class="mxinfo" id="T23:U276"><span class="mxinfo" id="T23:U277"><span class="mxinfo" id="T26:U278"><span class="mxinfo" id="T25:U279"><span class="var type1" id="S43T25U363">H_k</span></span>*<span class="var type1" id="S41T9U364">P_apriori</span></span>*<span class="mxinfo" id="T27:U282"><span class="var type1" id="S43T25U366">H_k</span>'</span></span>+<span class="var type1" id="S42T23U367">R</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">    <span class="mxinfo" id="T28:U285"><span class="var type1" id="S46T28U370">K_k</span>=(<span class="mxinfo" id="T28:U287"><span class="mxinfo" id="T28:U288"><span class="var type1" id="S41T9U374">P_apriori</span>*<span class="mxinfo" id="T27:U290"><span class="var type1" id="S43T25U376">H_k</span>'</span></span>/(<span class="var type1" id="S45T23U378">S_k</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line">    <span class="mxinfo" id="T10:U293"><span class="var type1" id="S4T10U381">x_aposteriori</span>=<span class="mxinfo" id="T10:U295"><span class="var type1" id="S39T10U383">x_apriori</span>+<span class="mxinfo" id="T10:U297"><span class="var type1" id="S46T28U385">K_k</span>*<span class="var type1" id="S44T24U386">y_k</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line">    <span class="mxinfo" id="T9:U300"><span class="var type1" id="S5T9U389">P_aposteriori</span>=<span class="mxinfo" id="T9:U302">(<span class="mxinfo" id="T9:U303"><span class="mxinfo" id="T20:U304">eye(12)</span>-<span class="mxinfo" id="T9:U305"><span class="var type1" id="S46T28U397">K_k</span>*<span class="mxinfo" id="T25:U307"><span class="var type1" id="S43T25U398">H_k</span></span></span></span>)*<span class="var type1" id="S41T9U399">P_apriori</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T5:U310"><span class="mxinfo" id="T48:U311"><span class="var type1" id="S6T21U407">updateVect</span>(<span class="mxinfo" id="T2:U313">1</span>)</span>==<span class="mxinfo" id="T2:U314">1</span></span>&amp;&amp;<span class="mxinfo" id="T5:U315"><span class="mxinfo" id="T48:U316"><span class="var type1" id="S6T21U412">updateVect</span>(<span class="mxinfo" id="T2:U318">2</span>)</span>==<span class="mxinfo" id="T2:U319">0</span></span>&amp;&amp;<span class="mxinfo" id="T5:U320"><span class="mxinfo" id="T48:U321"><span class="var type1" id="S6T21U417">updateVect</span>(<span class="mxinfo" id="T2:U323">3</span>)</span>==<span class="mxinfo" id="T2:U324">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">        <span class="mxinfo" id="T16:U325"><span class="var type1" id="S42T16U422">R</span>=<span class="mxinfo" id="T16:U327">diag(<span class="mxinfo" id="T33:U328"><span class="var type1" id="S12T22U426">r</span>(<span class="mxinfo" id="T50:U330"><span class="mxinfo" id="T2:U331">1</span>:<span class="mxinfo" id="T2:U332">3</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">        <span class="comment">%observation matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">        <span class="mxinfo" id="T34:U333"><span class="var type1" id="S43T34U432">H_k</span>=<span class="mxinfo" id="T34:U335">[  <span class="var type1" id="S35T15U435">E</span>,     <span class="var type1" id="S36T15U436">Es</span>,      <span class="var type1" id="S37T15U437">Z</span>,    <span class="var type1" id="S37T15U438">Z</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">        <span class="mxinfo" id="T17:U340"><span class="var type1" id="S44T17U441">y_k</span>=<span class="mxinfo" id="T17:U342"><span class="mxinfo" id="T17:U343"><span class="var type1" id="S8T24U444">z</span>(<span class="mxinfo" id="T50:U345"><span class="mxinfo" id="T2:U346">1</span>:<span class="mxinfo" id="T2:U347">3</span></span>)</span>-<span class="mxinfo" id="T17:U348"><span class="mxinfo" id="T34:U349"><span class="var type1" id="S43T34U450">H_k</span>(1:3,1:12)</span>*<span class="var type1" id="S39T10U457">x_apriori</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">        <span class="mxinfo" id="T16:U352"><span class="var type1" id="S45T16U460">S_k</span>=<span class="mxinfo" id="T16:U354"><span class="mxinfo" id="T16:U355"><span class="mxinfo" id="T35:U356"><span class="mxinfo" id="T34:U357"><span class="var type1" id="S43T34U465">H_k</span>(1:3,1:12)</span>*<span class="var type1" id="S41T9U472">P_apriori</span></span>*<span class="mxinfo" id="T36:U360"><span class="var type1" id="S43T34U475">H_k</span>(1:3,1:12)'</span></span>+<span class="mxinfo" id="T16:U362"><span class="var type1" id="S42T16U483">R</span>(<span class="mxinfo" id="T50:U364"><span class="mxinfo" id="T2:U365">1</span>:<span class="mxinfo" id="T2:U366">3</span></span>,<span class="mxinfo" id="T50:U367"><span class="mxinfo" id="T2:U368">1</span>:<span class="mxinfo" id="T2:U369">3</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">        <span class="mxinfo" id="T37:U370"><span class="var type1" id="S46T37U492">K_k</span>=(<span class="mxinfo" id="T37:U372"><span class="mxinfo" id="T37:U373"><span class="var type1" id="S41T9U496">P_apriori</span>*<span class="mxinfo" id="T36:U375"><span class="var type1" id="S43T34U499">H_k</span>(1:3,1:12)'</span></span>/(<span class="var type1" id="S45T16U507">S_k</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line">        <span class="mxinfo" id="T10:U378"><span class="var type1" id="S4T10U510">x_aposteriori</span>=<span class="mxinfo" id="T10:U380"><span class="var type1" id="S39T10U512">x_apriori</span>+<span class="mxinfo" id="T10:U382"><span class="var type1" id="S46T37U514">K_k</span>*<span class="var type1" id="S44T17U515">y_k</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">        <span class="mxinfo" id="T9:U385"><span class="var type1" id="S5T9U518">P_aposteriori</span>=<span class="mxinfo" id="T9:U387">(<span class="mxinfo" id="T9:U388"><span class="mxinfo" id="T20:U389">eye(12)</span>-<span class="mxinfo" id="T9:U390"><span class="var type1" id="S46T37U526">K_k</span>*<span class="mxinfo" id="T34:U392"><span class="var type1" id="S43T34U528">H_k</span>(1:3,1:12)</span></span></span>)*<span class="var type1" id="S41T9U535">P_apriori</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">        <span class="keyword">if</span>  <span class="mxinfo" id="T5:U395"><span class="mxinfo" id="T48:U396"><span class="var type1" id="S6T21U543">updateVect</span>(<span class="mxinfo" id="T2:U398">1</span>)</span>==<span class="mxinfo" id="T2:U399">1</span></span>&amp;&amp;<span class="mxinfo" id="T5:U400"><span class="mxinfo" id="T48:U401"><span class="var type1" id="S6T21U548">updateVect</span>(<span class="mxinfo" id="T2:U403">2</span>)</span>==<span class="mxinfo" id="T2:U404">1</span></span>&amp;&amp;<span class="mxinfo" id="T5:U405"><span class="mxinfo" id="T48:U406"><span class="var type1" id="S6T21U553">updateVect</span>(<span class="mxinfo" id="T2:U408">3</span>)</span>==<span class="mxinfo" id="T2:U409">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">            <span class="mxinfo" id="T39:U410"><span class="var type1" id="S42T39U558">R</span>=<span class="mxinfo" id="T39:U412">diag(<span class="mxinfo" id="T38:U413"><span class="var type1" id="S12T22U562">r</span>(<span class="mxinfo" id="T51:U415"><span class="mxinfo" id="T2:U416">1</span>:<span class="mxinfo" id="T2:U417">6</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">            <span class="comment">%observation matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">            <span class="mxinfo" id="T40:U418"><span class="var type1" id="S43T40U568">H_k</span>=<span class="mxinfo" id="T40:U420">[  <span class="var type1" id="S35T15U571">E</span>,     <span class="var type1" id="S36T15U572">Es</span>,      <span class="var type1" id="S37T15U573">Z</span>,    <span class="var type1" id="S37T15U574">Z</span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line"><span class="mxinfo" id="T40:U418"><span class="mxinfo" id="T40:U420">                <span class="var type1" id="S37T15U576">Z</span>,     <span class="var type1" id="S37T15U577">Z</span>,      <span class="var type1" id="S35T15U578">E</span>,    <span class="var type1" id="S37T15U579">Z</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">            <span class="mxinfo" id="T41:U429"><span class="var type1" id="S44T41U582">y_k</span>=<span class="mxinfo" id="T41:U431"><span class="mxinfo" id="T41:U432"><span class="var type1" id="S8T24U585">z</span>(<span class="mxinfo" id="T51:U434"><span class="mxinfo" id="T2:U435">1</span>:<span class="mxinfo" id="T2:U436">6</span></span>)</span>-<span class="mxinfo" id="T41:U437"><span class="mxinfo" id="T40:U438"><span class="var type1" id="S43T40U591">H_k</span>(1:6,1:12)</span>*<span class="var type1" id="S39T10U598">x_apriori</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">            <span class="mxinfo" id="T39:U441"><span class="var type1" id="S45T39U601">S_k</span>=<span class="mxinfo" id="T39:U443"><span class="mxinfo" id="T39:U444"><span class="mxinfo" id="T42:U445"><span class="mxinfo" id="T40:U446"><span class="var type1" id="S43T40U606">H_k</span>(1:6,1:12)</span>*<span class="var type1" id="S41T9U613">P_apriori</span></span>*<span class="mxinfo" id="T43:U449"><span class="var type1" id="S43T40U616">H_k</span>(1:6,1:12)'</span></span>+<span class="mxinfo" id="T39:U451"><span class="var type1" id="S42T39U624">R</span>(<span class="mxinfo" id="T51:U453"><span class="mxinfo" id="T2:U454">1</span>:<span class="mxinfo" id="T2:U455">6</span></span>,<span class="mxinfo" id="T51:U456"><span class="mxinfo" id="T2:U457">1</span>:<span class="mxinfo" id="T2:U458">6</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">            <span class="mxinfo" id="T44:U459"><span class="var type1" id="S46T44U633">K_k</span>=(<span class="mxinfo" id="T44:U461"><span class="mxinfo" id="T44:U462"><span class="var type1" id="S41T9U637">P_apriori</span>*<span class="mxinfo" id="T43:U464"><span class="var type1" id="S43T40U640">H_k</span>(1:6,1:12)'</span></span>/(<span class="var type1" id="S45T39U648">S_k</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">            <span class="mxinfo" id="T10:U467"><span class="var type1" id="S4T10U651">x_aposteriori</span>=<span class="mxinfo" id="T10:U469"><span class="var type1" id="S39T10U653">x_apriori</span>+<span class="mxinfo" id="T10:U471"><span class="var type1" id="S46T44U655">K_k</span>*<span class="var type1" id="S44T41U656">y_k</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line">            <span class="mxinfo" id="T9:U474"><span class="var type1" id="S5T9U659">P_aposteriori</span>=<span class="mxinfo" id="T9:U476">(<span class="mxinfo" id="T9:U477"><span class="mxinfo" id="T20:U478">eye(12)</span>-<span class="mxinfo" id="T9:U479"><span class="var type1" id="S46T44U667">K_k</span>*<span class="mxinfo" id="T40:U481"><span class="var type1" id="S43T40U669">H_k</span>(1:6,1:12)</span></span></span>)*<span class="var type1" id="S41T9U676">P_apriori</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">            <span class="keyword">if</span>  <span class="mxinfo" id="T5:U484"><span class="mxinfo" id="T48:U485"><span class="var type1" id="S6T21U684">updateVect</span>(<span class="mxinfo" id="T2:U487">1</span>)</span>==<span class="mxinfo" id="T2:U488">1</span></span>&amp;&amp;<span class="mxinfo" id="T5:U489"><span class="mxinfo" id="T48:U490"><span class="var type1" id="S6T21U689">updateVect</span>(<span class="mxinfo" id="T2:U492">2</span>)</span>==<span class="mxinfo" id="T2:U493">0</span></span>&amp;&amp;<span class="mxinfo" id="T5:U494"><span class="mxinfo" id="T48:U495"><span class="var type1" id="S6T21U694">updateVect</span>(<span class="mxinfo" id="T2:U497">3</span>)</span>==<span class="mxinfo" id="T2:U498">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">                <span class="mxinfo" id="T47:U499"><span class="var type1" id="S42T47U699">R</span>=<span class="mxinfo" id="T47:U501">diag(<span class="mxinfo" id="T46:U502">[<span class="mxinfo" id="T33:U503"><span class="var type1" id="S12T22U705">r</span>(<span class="mxinfo" id="T50:U505"><span class="mxinfo" id="T2:U506">1</span>:<span class="mxinfo" id="T2:U507">3</span></span>)</span>;<span class="mxinfo" id="T33:U508"><span class="var type1" id="S12T22U711">r</span>(<span class="mxinfo" id="T50:U510"><span class="mxinfo" id="T2:U511">7</span>:<span class="mxinfo" id="T2:U512">9</span></span>)</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">                <span class="comment">%observation matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">               </span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">                <span class="mxinfo" id="T40:U513"><span class="var type1" id="S43T40U717">H_k</span>=<span class="mxinfo" id="T40:U515">[  <span class="var type1" id="S35T15U720">E</span>,     <span class="var type1" id="S36T15U721">Es</span>,      <span class="var type1" id="S37T15U722">Z</span>,    <span class="var type1" id="S37T15U723">Z</span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line"><span class="mxinfo" id="T40:U513"><span class="mxinfo" id="T40:U515">                    <span class="var type1" id="S37T15U725">Z</span>,     <span class="var type1" id="S37T15U726">Z</span>,      <span class="var type1" id="S37T15U727">Z</span>,    <span class="var type1" id="S35T15U728">E</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">               </span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">                <span class="mxinfo" id="T41:U524"><span class="var type1" id="S44T41U731">y_k</span>=<span class="mxinfo" id="T41:U526"><span class="mxinfo" id="T41:U527">[<span class="mxinfo" id="T17:U528"><span class="var type1" id="S8T24U736">z</span>(<span class="mxinfo" id="T50:U530"><span class="mxinfo" id="T2:U531">1</span>:<span class="mxinfo" id="T2:U532">3</span></span>)</span>;<span class="mxinfo" id="T17:U533"><span class="var type1" id="S8T24U742">z</span>(<span class="mxinfo" id="T50:U535"><span class="mxinfo" id="T2:U536">7</span>:<span class="mxinfo" id="T2:U537">9</span></span>)</span>]</span>-<span class="mxinfo" id="T41:U538"><span class="mxinfo" id="T40:U539"><span class="var type1" id="S43T40U748">H_k</span>(1:6,1:12)</span>*<span class="var type1" id="S39T10U755">x_apriori</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">               </span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line">                <span class="mxinfo" id="T39:U542"><span class="var type1" id="S45T39U758">S_k</span>=<span class="mxinfo" id="T39:U544"><span class="mxinfo" id="T39:U545"><span class="mxinfo" id="T42:U546"><span class="mxinfo" id="T40:U547"><span class="var type1" id="S43T40U763">H_k</span>(1:6,1:12)</span>*<span class="var type1" id="S41T9U770">P_apriori</span></span>*<span class="mxinfo" id="T43:U550"><span class="var type1" id="S43T40U773">H_k</span>(1:6,1:12)'</span></span>+<span class="mxinfo" id="T39:U552"><span class="var type1" id="S42T47U781">R</span>(<span class="mxinfo" id="T51:U554"><span class="mxinfo" id="T2:U555">1</span>:<span class="mxinfo" id="T2:U556">6</span></span>,<span class="mxinfo" id="T51:U557"><span class="mxinfo" id="T2:U558">1</span>:<span class="mxinfo" id="T2:U559">6</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">                <span class="mxinfo" id="T44:U560"><span class="var type1" id="S46T44U790">K_k</span>=(<span class="mxinfo" id="T44:U562"><span class="mxinfo" id="T44:U563"><span class="var type1" id="S41T9U794">P_apriori</span>*<span class="mxinfo" id="T43:U565"><span class="var type1" id="S43T40U797">H_k</span>(1:6,1:12)'</span></span>/(<span class="var type1" id="S45T39U805">S_k</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">               </span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">               </span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">                <span class="mxinfo" id="T10:U568"><span class="var type1" id="S4T10U808">x_aposteriori</span>=<span class="mxinfo" id="T10:U570"><span class="var type1" id="S39T10U810">x_apriori</span>+<span class="mxinfo" id="T10:U572"><span class="var type1" id="S46T44U812">K_k</span>*<span class="var type1" id="S44T41U813">y_k</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">                <span class="mxinfo" id="T9:U575"><span class="var type1" id="S5T9U816">P_aposteriori</span>=<span class="mxinfo" id="T9:U577">(<span class="mxinfo" id="T9:U578"><span class="mxinfo" id="T20:U579">eye(12)</span>-<span class="mxinfo" id="T9:U580"><span class="var type1" id="S46T44U824">K_k</span>*<span class="mxinfo" id="T40:U582"><span class="var type1" id="S43T40U826">H_k</span>(1:6,1:12)</span></span></span>)*<span class="var type1" id="S41T9U833">P_apriori</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">                <span class="mxinfo" id="T10:U585"><span class="var type1" id="S4T10U837">x_aposteriori</span>=<span class="var type1" id="S39T10U838">x_apriori</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line">                <span class="mxinfo" id="T9:U588"><span class="var type1" id="S5T9U841">P_aposteriori</span>=<span class="var type1" id="S41T9U842">P_apriori</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line"><span class="comment">%% euler anglels extraction</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line"><span class="mxinfo" id="T17:U591"><span class="var type1" id="S47T17U845">z_n_b</span> = <span class="mxinfo" id="T17:U593"><span class="mxinfo" id="T17:U594">-<span class="mxinfo" id="T17:U595"><span class="var type1" id="S4T10U849">x_aposteriori</span>(<span class="mxinfo" id="T50:U597"><span class="mxinfo" id="T2:U598">7</span>:<span class="mxinfo" id="T2:U599">9</span></span>)</span></span>./<span class="mxinfo" id="T7:U600">norm(<span class="mxinfo" id="T17:U601"><span class="var type1" id="S4T10U856">x_aposteriori</span>(<span class="mxinfo" id="T50:U603"><span class="mxinfo" id="T2:U604">7</span>:<span class="mxinfo" id="T2:U605">9</span></span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line"><span class="mxinfo" id="T17:U606"><span class="var type1" id="S49T17U862">m_n_b</span> = <span class="mxinfo" id="T17:U608"><span class="mxinfo" id="T17:U609"><span class="var type1" id="S4T10U865">x_aposteriori</span>(<span class="mxinfo" id="T50:U611"><span class="mxinfo" id="T2:U612">10</span>:<span class="mxinfo" id="T2:U613">12</span></span>)</span>./<span class="mxinfo" id="T7:U614">norm(<span class="mxinfo" id="T17:U615"><span class="var type1" id="S4T10U872">x_aposteriori</span>(<span class="mxinfo" id="T50:U617"><span class="mxinfo" id="T2:U618">10</span>:<span class="mxinfo" id="T2:U619">12</span></span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line"><span class="mxinfo" id="T17:U620"><span class="var type1" id="S50T17U878">y_n_b</span>=<span class="mxinfo" id="T17:U622">cross(<span class="var type1" id="S47T17U881">z_n_b</span>,<span class="var type1" id="S49T17U882">m_n_b</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line"><span class="mxinfo" id="T17:U625"><span class="var type1" id="S50T17U885">y_n_b</span>=<span class="mxinfo" id="T17:U627"><span class="var type1" id="S50T17U887">y_n_b</span>./<span class="mxinfo" id="T7:U629">norm(<span class="var type1" id="S50T17U890">y_n_b</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line"><span class="mxinfo" id="T17:U631"><span class="var type1" id="S52T17U893">x_n_b</span>=(<span class="mxinfo" id="T17:U633">cross(<span class="var type1" id="S50T17U897">y_n_b</span>,<span class="var type1" id="S47T17U898">z_n_b</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line"><span class="mxinfo" id="T17:U636"><span class="var type1" id="S52T17U901">x_n_b</span>=<span class="mxinfo" id="T17:U638"><span class="var type1" id="S52T17U903">x_n_b</span>./<span class="mxinfo" id="T7:U640">norm(<span class="var type1" id="S52T17U906">x_n_b</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line"><span class="mxinfo" id="T16:U642"><span class="var type1" id="S3T16U909">Rot_matrix</span>=<span class="mxinfo" id="T16:U644">[<span class="var type1" id="S52T17U912">x_n_b</span>,<span class="var type1" id="S50T17U913">y_n_b</span>,<span class="var type1" id="S47T17U914">z_n_b</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line"><span class="mxinfo" id="T7:U648"><span class="var type1" id="S53T7U917">phi</span>=<span class="mxinfo" id="T7:U650">atan2(<span class="mxinfo" id="T7:U651"><span class="var type1" id="S3T16U921">Rot_matrix</span>(<span class="mxinfo" id="T2:U653">2</span>,<span class="mxinfo" id="T2:U654">3</span>)</span>,<span class="mxinfo" id="T7:U655"><span class="var type1" id="S3T16U925">Rot_matrix</span>(<span class="mxinfo" id="T2:U657">3</span>,<span class="mxinfo" id="T2:U658">3</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line"><span class="mxinfo" id="T7:U659"><span class="var type1" id="S55T7U930">theta</span>=<span class="mxinfo" id="T7:U661">-<span class="mxinfo" id="T7:U662">asin(<span class="mxinfo" id="T7:U663"><span class="var type1" id="S3T16U935">Rot_matrix</span>(<span class="mxinfo" id="T2:U665">1</span>,<span class="mxinfo" id="T2:U666">3</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line"><span class="mxinfo" id="T7:U667"><span class="var type1" id="S57T7U940">psi</span>=<span class="mxinfo" id="T7:U669">atan2(<span class="mxinfo" id="T7:U670"><span class="var type1" id="S3T16U944">Rot_matrix</span>(<span class="mxinfo" id="T2:U672">1</span>,<span class="mxinfo" id="T2:U673">2</span>)</span>,<span class="mxinfo" id="T7:U674"><span class="var type1" id="S3T16U948">Rot_matrix</span>(<span class="mxinfo" id="T2:U676">1</span>,<span class="mxinfo" id="T2:U677">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line"><span class="mxinfo" id="T17:U678"><span class="var type1" id="S2T17U953">eulerAngles</span>=<span class="mxinfo" id="T17:U680">[<span class="var type1" id="S53T7U956">phi</span>;<span class="var type1" id="S55T7U958">theta</span>;<span class="var type1" id="S57T7U960">psi</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line"></span></span>
</pre>
